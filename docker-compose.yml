services:
  jellyfin-dev:
    image: jellyfin/jellyfin:10.10.3
    container_name: shirarium-jellyfin-dev
    ports:
      - "${JELLYFIN_PORT:-8097}:8096"
    environment:
      - JELLYFIN_PublishedServerUrl=http://localhost:${JELLYFIN_PORT:-8097}
    volumes:
      - ./data/jellyfin/config:/config
      - ./data/jellyfin/cache:/cache
      - ${MEDIA_PATH}:/media:ro
      - ./artifacts/plugin:/config/plugins/Shirarium
    depends_on:
      - engine
    restart: unless-stopped

  engine:
    build:
      context: ./engine
    container_name: shirarium-engine
    ports:
      - "${ENGINE_PORT:-8787}:8787"
    environment:
      - SHIRARIUM_USE_OLLAMA=${USE_OLLAMA:-false}
      - SHIRARIUM_OLLAMA_BASE_URL=${OLLAMA_BASE_URL:-http://ollama:11434}
      - SHIRARIUM_OLLAMA_MODEL=${OLLAMA_MODEL:-llama3.1:8b}
    restart: unless-stopped

  ollama:
    image: ollama/ollama:latest
    container_name: shirarium-ollama
    ports:
      - "11434:11434"
    volumes:
      - ./data/ollama:/root/.ollama
    profiles:
      - local-llm
    restart: unless-stopped
